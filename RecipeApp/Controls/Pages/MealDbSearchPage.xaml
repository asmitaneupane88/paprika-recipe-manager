<pages:NavigatorPage
    x:Class="RecipeApp.Controls.Pages.MealDbSearchPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vm="using:RecipeApp.ViewModels"
    xmlns:models="using:RecipeApp.Models"
    xmlns:pages="clr-namespace:RecipeApp.Controls.Pages">

    <Page.DataContext>
        <vm:SearchViewModel x:Name="ViewModel" />
    </Page.DataContext>

    <Grid Padding="20" RowDefinitions="Auto, Auto, *">

        <!-- Search Bar -->
        <StackPanel Orientation="Horizontal" Spacing="8">
            <TextBox Width="300"
                     PlaceholderText="Search recipe..."
                     Text="{x:Bind ViewModel.Query, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
            <Button Content="Search"
                    Command="{x:Bind ViewModel.SearchCommand}"/>
        </StackPanel>

        <!-- Results -->
        <ListView Grid.Row="2"
                  ItemsSource="{x:Bind ViewModel.Recipes}"
                  Margin="0,16,0,0">
            <ListView.ItemTemplate>
                <DataTemplate x:DataType="models:MealDbRecipe">
                    <Button Click="Recipe_Click" 
                            HorizontalAlignment="Stretch"
                            HorizontalContentAlignment="Stretch"
                            Style="{ThemeResource ButtonRevealStyle}"
                            Padding="0"
                            Background="Transparent">
                        <StackPanel Orientation="Horizontal" Spacing="12" Padding="8">
                            <Image Source="{x:Bind ImageUrl}" Width="100" Height="100"/>
                            <StackPanel>
                                <TextBlock Text="{x:Bind Name}" FontWeight="Bold" FontSize="18"/>
                                <TextBlock Text="{x:Bind Category}" Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}" 
                                         Style="{ThemeResource CaptionTextBlockStyle}"/>
                                <TextBlock Text="{x:Bind Ingredients}"
                                         Style="{ThemeResource CaptionTextBlockStyle}"
                                         TextWrapping="WrapWholeWords"
                                         MaxWidth="400"
                                         Opacity="0.8"
                                         Margin="0,4,0,0"/>
                            </StackPanel>
                        </StackPanel>
                    </Button>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>
    </Grid>
</pages:NavigatorPage>
